//================== SysCAD - Copyright Kenwalt (Pty) Ltd ===================
// $Nokeywords: $
//===========================================================================
/* -3 */
/********************************** C3H.C **********************************/
/********************* 3d homogeneous vector geometry **********************/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
#ifdef SPLINE
#include <c3hdefs.h>
#include <c3vdefs.h>
#include <c3vpriv.h>
#include <c3vmcrs.h>
#include <c3hmcrs.h>

/*-------------------------------------------------------------------------*/
BBS_PRIVATE void    c3h_set_zero ( a ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT3 a ;
{
    a[0] = 0.0 ;
    a[1] = 0.0 ;
    a[2] = 0.0 ;
    a[3] = 1.0 ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void    c3h_set ( x, y, z, w, a ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
REAL x, y, z, w ;
HPT3 a ;
{
    a[0] = x ;
    a[1] = y ;
    a[2] = z ;
    a[3] = w ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void    c3h_copy ( a, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT3 a, b ;
{
    b[0] = a[0] ;
    b[1] = a[1] ;
    b[2] = a[2] ;
    b[3] = a[3] ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void    c3h_diff ( a, b, c ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT3 a, b ;
PT3 c ;
{
    c[0] = a[0] * b[3] - b[0] * a[3] ;
    c[1] = a[1] * b[3] - b[1] * a[3] ;
    c[2] = a[2] * b[3] - b[2] * a[3] ;
}

/*-------------------------------------------------------------------------*/
BBS_PRIVATE void    c3h_sub ( a, v, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT3 a ;
PT3 b, v ;
{
    b[0] = a[0] - v[0] * a[3] ;
    b[1] = a[1] - v[1] * a[3] ;
    b[2] = a[2] - v[2] * a[3] ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void    c3h_addv ( a, v, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT3 a, b ;
PT3 v ;
{
    b[0] = a[0] + v[0] * a[3] ;
    b[1] = a[1] + v[1] * a[3] ;
    b[2] = a[2] + v[2] * a[3] ;
    b[3] = a[3] ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void    c3h_mirror ( a, normal, d, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT3 a, b ;
PT3 normal ;
REAL d ;
{
    REAL t ;

    t = 2.0 * ( d - C3V_DOT ( a, normal ) ) ;
    C3V_ADDT ( a, normal, t, b ) ;
    b[3] = a[3] ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE BOOLEAN c3h_hpt_pt ( a, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT3 a ;
PT3 b ;
{
    if ( HPT3_INF(a) ) 
        RETURN ( FALSE ) ;
    b[0] = a[0] / a[3] ;
    b[1] = a[1] / a[3] ;
    b[2] = a[2] / a[3] ;
    RETURN ( TRUE ) ;
}



/*-------------------------------------------------------------------------*/
BBS_PRIVATE void c3h_pt_hpt ( a, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT3 a ;
HPT3 b ;
{
    b[0] = a[0] ;
    b[1] = a[1] ;
    b[2] = a[2] ;
    b[3] = 1.0 ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void c3h_conv_3d2d ( a, c, u, v, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT3 a ;
PT3 c, u, v ;
HPT2 b ;
{
    PT3 z ;

/*
    C3V_SUB ( a, c, z ) ;
*/
    C3V_ADDT ( a, c, -a[3], z ) ;

    b[0] = C3V_DOT ( z, u ) ;
    b[1] = C3V_DOT ( z, v ) ;
    b[2] = a[3] ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void c3h_conv_2d3d ( b, c, u, v, a ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT2 b ;
PT3 c, u, v ;
HPT3 a ;
{
    a[0] = c[0] * b[2] + u[0] * b[0] + v[0] * b[1] ;
    a[1] = c[1] * b[2] + u[1] * b[0] + v[1] * b[1] ;
    a[2] = c[2] * b[2] + u[2] * b[0] + v[2] * b[1] ;
    a[3] = b[2] ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void        c3h_rotate ( a, origin, axis, angle, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT3 a, b ;
PT3 origin, axis ;  /* axis is normalized */
REAL angle ;
{
    REAL c, s ;
    c = cos ( angle ) ;
    s = sin ( angle ) ;
    c3h_rotate_cs ( a, origin, axis, c, s, b ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void        c3h_rotate_cs ( a, origin, axis, c, s, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT3 a, b ;
PT3 origin, axis ;  /* axis is normalized */
REAL c, s ;
{
    PT3 a1, a2 ;
    REAL w ;

    C3H_SUB ( a, origin, a1 ) ;
    C3V_CROSS ( axis, a1, a2 ) ;
    w = C3V_DOT ( a1, axis ) * ( 1.0 - c ) * a[3] ;
    b[0] = origin[0] * a[3] + c * a1[0] + w * axis[0] + s * a2[0] ;
    b[1] = origin[1] * a[3] + c * a1[1] + w * axis[1] + s * a2[1] ;
    b[2] = origin[2] * a[3] + c * a1[2] + w * axis[2] + s * a2[2] ;
    b[3] = a[3] ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE BOOLEAN c3h_project_oblique ( a, normal, dist, direction, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT3 a, normal, direction, b ;
REAL dist ;
{
    REAL dot, t ;

    dot = C3V_DOT ( direction, normal ) ;
    if ( IS_SMALL(dot) ) 
        RETURN ( FALSE ) ;
    t = ( dist*a[3] - C3V_DOT ( a, normal ) ) / dot ;
    C3V_ADDT ( a, direction, t, b ) ;
    b[3] = a[3] ;

    RETURN ( TRUE ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE BOOLEAN c3h_on_plane ( p, normal, dist ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT3 p ;
PT3 normal ;
REAL dist ;
{
    RETURN ( IS_SMALL( C3V_DOT ( p, normal ) - dist*p[3] ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void c3h_plane_def ( a, p, normal, dist_ptr, deg_ptr ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT3 a ;
PT3 p[2], normal ;
REAL *dist_ptr ;
INT *deg_ptr ;
{
    PT3 b ;
    if ( c3h_hpt_pt ( a, b ) )
        c3v_plane_def ( b, p, normal, dist_ptr, deg_ptr ) ;
}
#endif /*SPLINE*/

