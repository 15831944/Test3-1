//================== SysCAD - Copyright Kenwalt (Pty) Ltd ===================
// $Nokeywords: $
//===========================================================================
/* -3 */
/********************************** C3L.C **********************************/
/******************** Routines for processing lines ************************/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
#include <c3ldefs.h>
#include <c3adefs.h>
#include <c3vdefs.h>
#include <c3vpriv.h>
#include <c3lmcrs.h>
#include <c3vmcrs.h>
#include <c3mem.h>

/*-------------------------------------------------------------------------*/
BBS_PRIVATE C3_LINE c3l_create_copy ( line0 ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/

C3_LINE line0 ;
{
    C3_LINE line ;
    line = C3_ALLOC_LINE ;
    if ( line != NULL ) 
        c3l_copy ( line0, line ) ;
    RETURN ( line ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void c3l_copy ( line0, line ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/

C3_LINE line0, line ;
{
    C3V_COPY ( C3_LINE_PT0(line0), C3_LINE_PT0(line) ) ;
    C3V_COPY ( C3_LINE_PT1(line0), C3_LINE_PT1(line) ) ;
}


/*----------------------------------------------------------------------*/
BBS_PRIVATE C3_LINE c3l_create_2pts ( ept0, ept1 ) 
/*----------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                      !!!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software!!!!!!!*/
/*!!!!!!!!                   All rights reserved                !!!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT3 ept0, ept1 ;
{
    C3_LINE line ;

    line = C3_ALLOC_LINE ;
    if ( line != NULL ) 
        c3l_2pts ( ept0, ept1, line ) ;
    RETURN ( line ) ;
}


/*----------------------------------------------------------------------*/
BBS_PRIVATE void c3l_2pts ( ept0, ept1, line ) 
/*----------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                      !!!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software!!!!!!!*/
/*!!!!!!!!                   All rights reserved                !!!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C3_LINE line ;
PT3 ept0, ept1 ;
{
    C3V_COPY ( ept0, C3_LINE_PT0(line) ) ;
    C3V_COPY ( ept1, C3_LINE_PT1(line) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void c3l_eval ( line, t, p, x ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C3_LINE line ;
REAL t ;
INT p ;
PT3 *x ;
{
    INT i ;

    if ( p<0 ) 
        RETURN ; 
    C3V_ADDU ( C3_LINE_PT0(line), C3_LINE_PT1(line), t, x[0] ) ;
    if ( p<1 ) 
        RETURN ; 
    C3_LINE_DIR_VEC ( line, x[1] ) ;
    if ( p<2 ) 
        RETURN ; 
    for ( i=2; i<=p ; i++ )
        C3V_SET_ZERO ( x[i] ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE REAL c3l_project ( line, pt, proj_pt ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C3_LINE line ;
PT3 pt, proj_pt ;
{
    PT3 dir_vec, pr_vec ;
    REAL t ;

    C3V_SUB ( pt, C3_LINE_PT0(line), pr_vec ) ;
    C3_LINE_DIR_VEC ( line, dir_vec ) ;
    t = C3V_DOT ( pr_vec, dir_vec ) / C3V_DOT ( dir_vec, dir_vec ) ; 
    if ( proj_pt != NULL ) 
        C3V_ADDT ( C3_LINE_PT0(line), dir_vec, t, proj_pt ) ;
    RETURN ( t ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void c3l_box ( line, t0, t1, box ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/

C3_LINE line ;
REAL t0, t1 ;
C3_BOX box ;
{
    PT3 pt ;
    C3V_ADDU ( C3_LINE_PT0(line), C3_LINE_PT1(line), t0, pt ) ;
    c3a_box_init_pt ( box, pt ) ;
    C3V_ADDU ( C3_LINE_PT0(line), C3_LINE_PT1(line), t1, pt ) ;
    c3a_box_append_pt ( box, pt ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE REAL c3l_length ( line, t0, t1 ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C3_LINE line ;
REAL t0, t1 ;
{
    PT3 dir_vec ;

    C3_LINE_DIR_VEC ( line, dir_vec ) ;
    RETURN ( ( t1 - t0 ) * C3V_NORM ( dir_vec ) ) ;
}


/*----------------------------------------------------------------------*/
BBS_PRIVATE BBS_PUBLIC BOOLEAN c3l_on_plane ( line, normal, dist ) 
/*----------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                      !!!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software!!!!!!!*/
/*!!!!!!!!                   All rights reserved                !!!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C3_LINE line ;
PT3 normal ;
REAL dist ;
{
    RETURN ( c3v_pt_on_plane ( C3_LINE_PT0(line), normal, dist ) && 
        c3v_pt_on_plane ( C3_LINE_PT1(line), normal, dist ) ) ;
}


/*----------------------------------------------------------------------*/
BBS_PRIVATE void c3l_plane_def ( line, normal, dist_ptr, p, deg_ptr ) 
/*----------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                      !!!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software!!!!!!!*/
/*!!!!!!!!                   All rights reserved                !!!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C3_LINE line ;
PT3 normal ;
REAL *dist_ptr ;
PT3 p[2] ;
INT *deg_ptr ;
{
    c3v_plane_def ( C3_LINE_PT0(line), p, normal, dist_ptr, deg_ptr ) ;
    c3v_plane_def ( C3_LINE_PT1(line), p, normal, dist_ptr, deg_ptr ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE C3_LINE c3l_reverse ( line0, line1 ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C3_LINE line0, line1 ;
{
    PT3 p ;
    C3V_COPY ( C3_LINE_PT0(line0), p ) ;
    C3V_COPY ( C3_LINE_PT1(line0), C3_LINE_PT0(line1) ) ;
    C3V_COPY ( p, C3_LINE_PT1(line1) ) ;
    RETURN ( line1 ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE BOOLEAN c3l_get_pts_d ( line, t0, t1, pt0, pt1, d_vec ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!! (C) Copyright 1989, 1990, 1991 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C3_LINE line ;
REAL t0, t1 ;
PT3 pt0, pt1, d_vec ;
{
    C3V_ADDU ( C3_LINE_PT0(line), C3_LINE_PT1(line), t0, pt0 ) ;
    C3V_ADDU ( C3_LINE_PT0(line), C3_LINE_PT1(line), t1, pt1 ) ;
    C3V_SET_ZERO ( d_vec ) ;
    RETURN ( TRUE ) ;
}

